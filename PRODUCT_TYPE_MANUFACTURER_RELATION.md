# Връзка между типове продукти и производители

## Обзор
Добавена е функционалност за създаване на връзка много-към-много между типове продукти и производители. Това позволява да се дефинира кои производители са релевантни за конкретен тип продукт.

## Функционалности

### Backend API Endpoints

#### Управление на производители за тип продукт
- `GET /api/product-types/:id/manufacturers` - Вземане на производителите за даден тип продукт
- `POST /api/product-types/:id/manufacturers` - Обновяване на производителите за даден тип продукт
  ```json
  {
    "manufacturerIds": ["mf_foglie_doro", "mf_friulparchet"]
  }
  ```

#### Филтриране на производители по тип продукт
- `GET /api/manufacturers/by-product-type/:productTypeId` - Вземане на производители свързани с конкретен тип продукт

### Frontend Функционалности

#### Модал за редакция на типове продукти
- Добавена секция "Свързани производители" в модала за редакция на типове продукти
- Checkbox-ове за избор на производители
- Автоматично запазване на промените

#### Модал за създаване на продукти
- При избор на тип продукт се зареждат само свързаните производители
- Fallback към всички производители ако няма специфични връзки
- Уведомления за състоянието на зареждането

### База данни

#### Нова таблица
```sql
CREATE TABLE product_type_manufacturers (
  id TEXT PRIMARY KEY,
  productTypeId TEXT NOT NULL,
  manufacturerId TEXT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (productTypeId) REFERENCES product_types(id) ON DELETE CASCADE,
  FOREIGN KEY (manufacturerId) REFERENCES manufacturers(id) ON DELETE CASCADE,
  UNIQUE(productTypeId, manufacturerId)
);
```

## Как да използвате

1. **Конфигуриране на типове продукти:**
   - Отидете в модула за управление на атрибути
   - Кликнете "Редактирай" на даден тип продукт
   - В секцията "Свързани производители" изберете релевантните производители
   - Запазете промените

2. **Създаване на продукти:**
   - Отворете модала за създаване на продукт
   - Изберете тип продукт
   - Автоматично ще се заредят само свързаните производители
   - Изберете производител от филтрирания списък

## Примери

### Тестване на API
```bash
# Добавяне на производители към паркет
curl -X POST "http://localhost:4000/api/product-types/pt_parquet/manufacturers" \
  -H "Content-Type: application/json" \
  -d '{"manufacturerIds": ["mf_foglie_doro", "mf_friulparchet", "mf_arte_brotto"]}'

# Вземане на производители за паркет
curl "http://localhost:4000/api/manufacturers/by-product-type/pt_parquet"
```

### Резултат
- При избор на "Паркет" като тип продукт се показват само Foglie d'Oro, Friulparchet и Arte Brotto
- При избор на "Врати" се показват само Bluinterni и Decastelli
- При липса на връзки се показват всички производители

## Технически детайли

- Използва се Prisma транзакция за атомично обновяване на връзките
- Frontend има fallback логика при липса на специфични производители
- Уведомления информират потребителя за състоянието на операциите
- Валидация на входните данни на всички нива

## Бъдещи подобрения

- Възможност за масово управление на връзки
- Наследяване на атрибути въз основа на връзките
- Автоматично предлагане на производители при създаване на нови типове продукти 